# 项目部署方法

## 项目概述
本项目是一个基于Next.js 14的现代化Web应用，提供产品展示平台功能，支持多语言国际化。

## 1. 开发环境配置要求

### 系统要求
- **操作系统**: macOS 10.15+ / Windows 10+ / Linux Ubuntu 18.04+
- **Node.js**: 版本 18.17.0 或更高版本
- **包管理器**: npm 9.0.0+ 或 yarn 1.22.0+
- **Git**: 版本 2.30.0+

### 推荐开发工具
- **代码编辑器**: VS Code (推荐安装ESLint、Prettier、TypeScript插件)
- **浏览器**: Chrome 90+ / Firefox 88+ / Safari 14+
- **终端**: iTerm2 (macOS) / Windows Terminal (Windows)

## 2. 环境变量配置

### 必需环境变量
在项目根目录创建 `.env.local` 文件：

```bash
# 应用基础配置
NEXT_PUBLIC_APP_NAME="Display Platform"
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# 国际化配置
NEXT_PUBLIC_DEFAULT_LOCALE="en"
NEXT_PUBLIC_LOCALES="en,zh"

# API配置（如使用后端服务）
NEXT_PUBLIC_API_URL="http://localhost:8000/api"
NEXT_PUBLIC_API_KEY="your-api-key-here"

# 功能开关
NEXT_PUBLIC_ENABLE_ANALYTICS="false"
NEXT_PUBLIC_ENABLE_PWA="false"
```

### 生产环境变量
生产环境需要额外配置：

```bash
# 生产环境配置
NODE_ENV="production"

# 安全配置
NEXTAUTH_SECRET="your-secret-key-here"
NEXTAUTH_URL="https://your-domain.com"

# 数据库配置（如使用）
DATABASE_URL="postgresql://user:password@localhost:5432/dbname"

# 第三方服务配置
GOOGLE_ANALYTICS_ID="GA-TRACKING-ID"
STRIPE_PUBLISHABLE_KEY="pk_test_..."
```

## 3. 技术栈与版本信息

### 主要技术栈
- **前端框架**: Next.js 14.2.5
- **编程语言**: TypeScript 5.5.4
- **UI框架**: React 18.3.1
- **样式方案**: Tailwind CSS 3.4.6
- **国际化**: next-intl 3.13.0
- **动画库**: GSAP 3.14.2
- **3D图形**: Three.js 0.183.2

### 开发工具
- **构建工具**: Webpack (Next.js内置)
- **代码检查**: ESLint 8.57.0
- **包管理**: npm 9.0.0+
- **版本控制**: Git

## 4. 本地部署步骤

### 步骤1: 环境准备
```bash
# 检查Node.js版本
node --version  # 需要 >= 18.17.0

# 检查npm版本
npm --version   # 需要 >= 9.0.0
```

### 步骤2: 获取代码
```bash
# 克隆项目
git clone <repository-url>
cd comp_website-main-2/display_platform

# 或使用现有项目
cd /Users/mardan/Desktop/comp_website-main-2/display_platform
```

### 步骤3: 安装依赖
```bash
# 使用npm安装依赖
npm install

# 或使用yarn（如已安装）
yarn install
```

### 步骤4: 环境配置
```bash
# 创建环境变量文件
cp .env.example .env.local

# 编辑环境变量
nano .env.local  # 或使用其他编辑器
```

### 步骤5: 开发模式启动
```bash
# 启动开发服务器
npm run dev

# 或使用yarn
yarn dev
```

### 步骤6: 访问应用
打开浏览器访问: http://localhost:3000

### 步骤7: 代码检查（可选）
```bash
# 运行ESLint检查
npm run lint

# 构建检查
npm run build
```

## 5. 生产环境部署

### 方法一: Vercel部署（推荐）

#### 1. 准备Vercel账户
- 访问 https://vercel.com 注册账户
- 安装Vercel CLI: `npm i -g vercel`

#### 2. 项目配置
```bash
# 在项目根目录创建 vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/next"
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

#### 3. 部署命令
```bash
# 登录Vercel
vercel login

# 部署到生产环境
vercel --prod

# 或部署到预览环境
vercel
```

### 方法二: 传统服务器部署

#### 1. 服务器准备
```bash
# 更新系统包
sudo apt update && sudo apt upgrade -y

# 安装Node.js（使用NodeSource仓库）
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装PM2进程管理器
sudo npm install -g pm2

# 安装Nginx
sudo apt install nginx -y
```

#### 2. 项目部署
```bash
# 创建项目目录
sudo mkdir -p /var/www/display-platform
sudo chown $USER:$USER /var/www/display-platform

# 上传项目文件（通过Git或FTP）
cd /var/www/display-platform
git clone <repository-url> .

# 安装依赖
npm install --production

# 构建项目
npm run build
```

#### 3. PM2配置
```bash
# 创建PM2配置文件 ecosystem.config.js
module.exports = {
  apps: [{
    name: 'display-platform',
    script: 'node_modules/next/dist/bin/next',
    args: 'start',
    instances: 'max',
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
};

# 启动应用
pm2 start ecosystem.config.js
pm2 startup
pm2 save
```

#### 4. Nginx配置
```bash
# 创建Nginx配置文件
sudo nano /etc/nginx/sites-available/display-platform

# 配置文件内容
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # 静态资源缓存
    location /_next/static/ {
        proxy_cache_valid 200 302 1y;
        proxy_pass http://localhost:3000;
    }
}

# 启用站点
sudo ln -s /etc/nginx/sites-available/display-platform /etc/nginx/sites-enabled/
sudo nginx -t  # 测试配置
sudo systemctl reload nginx
```

#### 5. SSL证书配置（可选）
```bash
# 使用Certbot安装SSL证书
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d your-domain.com
```

### 方法三: Docker部署

#### 1. 创建Dockerfile
```dockerfile
FROM node:18-alpine

WORKDIR /app

# 复制package文件
COPY package*.json ./

# 安装依赖
RUN npm ci --only=production

# 复制源代码
COPY . .

# 构建应用
RUN npm run build

# 暴露端口
EXPOSE 3000

# 启动命令
CMD ["npm", "start"]
```

#### 2. 创建docker-compose.yml
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    restart: unless-stopped
```

#### 3. 构建和运行
```bash
# 构建镜像
docker-compose build

# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f
```

## 6. 部署验证

### 健康检查
```bash
# 检查应用是否正常运行
curl -I http://localhost:3000

# 检查端口占用
netstat -tulpn | grep :3000

# 检查PM2状态
pm2 status
```

### 功能测试
1. **首页访问**: 确保首页正常加载
2. **多语言切换**: 测试中英文切换功能
3. **动画效果**: 验证GSAP动画正常工作
4. **响应式设计**: 在不同设备尺寸下测试
5. **性能检查**: 使用Lighthouse进行性能测试

### 监控配置
```bash
# 安装监控工具
npm install -g clinic

# 性能分析
clinic doctor -- node server.js
```

## 7. 故障排除

### 常见问题

#### 1. 端口占用
```bash
# 查找占用端口的进程
lsof -i :3000

# 终止进程
kill -9 <PID>
```

#### 2. 内存不足
```bash
# 增加Node.js内存限制
export NODE_OPTIONS="--max-old-space-size=4096"
```

#### 3. 依赖安装失败
```bash
# 清理缓存
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

#### 4. 构建错误
```bash
# 检查TypeScript错误
npx tsc --noEmit

# 修复ESLint错误
npm run lint -- --fix
```

### 日志查看
```bash
# 查看应用日志
pm2 logs display-platform

# 查看Nginx日志
sudo tail -f /var/log/nginx/error.log

# 查看系统日志
journalctl -u nginx -f
```

## 8. 维护与更新

### 定期维护任务
1. **依赖更新**: 每月检查并更新依赖包
2. **安全扫描**: 使用`npm audit`检查安全漏洞
3. **备份数据**: 定期备份数据库和配置文件
4. **性能监控**: 监控服务器资源使用情况

### 更新流程
```bash
# 拉取最新代码
git pull origin main

# 安装新依赖
npm install

# 重新构建
npm run build

# 重启应用
pm2 restart display-platform
```

---
